package graph

// This file will be automatically regenerated based on the schema, any resolver implementations
// will be copied through when generating and any unknown code will be moved to the end.
// Code generated by github.com/99designs/gqlgen version v0.17.81

import (
	"context"
	"errors"
	"warimas-be/internal/graph/model"
	"warimas-be/internal/product"
	"warimas-be/internal/utils"
)

// CreateVariants is the resolver for the createVariants field.
func (r *mutationResolver) CreateVariants(ctx context.Context, input []*model.NewVariant) ([]*model.Variant, error) {
	_, ok := utils.GetUserIDFromContext(ctx)
	if !ok {
		return nil, errors.New("unauthorized: please login first")
	}

	svcInput := make([]*product.NewVariantInput, len(input))
	for i, v := range input {
		svcInput[i] = &product.NewVariantInput{
			ProductID:    v.ProductID,
			QuantityType: v.QuantityType,
			Name:         v.Name,
			Price:        v.Price,
			Stock:        int32(v.Stock),
			ImageURL:     v.ImageURL,
			Description:  v.Description,
		}
	}

	v, err := r.ProductSvc.CreateVariants(ctx, svcInput)
	if err != nil {
		return nil, err
	}

	res := make([]*model.Variant, len(v))
	for i, variant := range v {
		res[i] = MapVariantToGraphQL(variant)
	}

	return res, nil
}

// UpdateVariants is the resolver for the updateVariants field.
func (r *mutationResolver) UpdateVariants(ctx context.Context, input []*model.UpdateVariant) ([]*model.Variant, error) {
	_, ok := utils.GetUserIDFromContext(ctx)
	if !ok {
		return nil, errors.New("unauthorized: please login first")
	}

	svcInput := make([]*product.UpdateVariantInput, len(input))
	for i, v := range input {
		var stock *int32
		if v.Stock != nil {
			s := int32(*v.Stock)
			stock = &s
		}
		svcInput[i] = &product.UpdateVariantInput{
			ID:           v.ID,
			ProductID:    v.ProductID,
			QuantityType: v.QuantityType,
			Name:         v.Name,
			Price:        v.Price,
			Stock:        stock,
			ImageURL:     v.ImageURL,
			Description:  v.Description,
		}
	}

	v, err := r.ProductSvc.UpdateVariants(ctx, svcInput)
	if err != nil {
		return nil, err
	}

	res := make([]*model.Variant, len(v))
	for i, variant := range v {
		res[i] = MapVariantToGraphQL(variant)
	}

	return res, nil
}
